# Web版デバッグツール使用方法

このドキュメントでは、Mist ED BackendのWeb版デバッグツールの使用方法について説明します。

## 概要

Web版デバッグツールは、ブラウザからアクセスできる直感的なWebインターフェースで、バックエンドの動作確認を容易にします。独立したデバッグサーバーとして動作し、通常のバックエンドとは分離されています。

## アーキテクチャ

- **フロントエンド**: React + TypeScript + Tailwind CSS
- **デバッグサーバー**: Go + Echo (独立したサーバー)
- **通信**: REST API (JSON)
- **データベース**: 既存のPostgreSQLデータベースを共有

## セットアップ

### 1. デバッグサーバーの起動

デバッグ用の独立したサーバーを起動します。

```bash
# デバッグサーバーを起動
go run cmd/debug-server/main.go
```

デバッグサーバーはデフォルトでポート8081で起動します。

### 2. フロントエンドの起動

```bash
cd debug-web
npm install
npm start
```

### 3. 環境設定

フロントエンドがデバッグサーバーに接続するためのURLを設定します。

```bash
# debug-web/.env.local ファイルを作成
echo "REACT_APP_API_URL=http://localhost:8081" > .env.local
```

### 4. 環境変数の設定

デバッグサーバーは`.env`ファイルから環境変数を読み取ります。

```bash
# .env ファイルの例
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=password
DB_NAME=mist_ed
DB_SSLMODE=disable
DEBUG_SERVER_PORT=8081
```

## 主要機能

### 1. データの一覧表示
- 各リソース（組織、ユーザー、部屋、デバイス、科目、授業）のデータを表形式で表示
- リアルタイムでのデータ更新
- レスポンシブデザイン対応

### 2. データの作成
- 各リソースのテストデータを個別に作成
- 依存関係の自動解決（例：ユーザー作成前に組織が必要）
- 作成結果の即座な反映

### 3. データの削除
- 各リソースの全データを削除
- 確認ダイアログによる安全な削除
- 削除結果の即座な反映

### 4. シードデータ作成
- 開発・テスト用のサンプルデータを一括作成
- 関連するデータの自動生成
- 既存データの保持

### 5. データベースリセット
- 全テーブルのデータを削除
- クリーンな状態への復元
- 確認ダイアログによる安全な操作

## 使用方法

### 基本的な動作確認フロー

1. **デバッグサーバーを起動**
   ```bash
   go run cmd/debug-server/main.go
   ```

2. **フロントエンドを起動**
   ```bash
   cd debug-web
   npm start
   ```

3. **ブラウザでアクセス**
   ```
   http://localhost:3000
   ```

4. **データベースをリセット**
   - 「データベースリセット」ボタンをクリック
   - 確認ダイアログで「OK」を選択

5. **シードデータを作成**
   - 「シードデータ作成」ボタンをクリック
   - 確認ダイアログで「OK」を選択

6. **データを確認**
   - 各テーブルでデータが表示されることを確認
   - データ件数が表示されることを確認

7. **個別操作**
   - 各テーブルの「作成」ボタンで個別データ作成
   - 各テーブルの「全削除」ボタンで個別データ削除
   - 各テーブルの「更新」ボタンでデータ再読み込み

### 画面構成

#### メイン画面
- **ヘッダー**: ツール名と説明
- **コントロールパネル**: シードデータ作成・データベースリセット
- **データテーブル**: 6つのリソースを2列×3行で表示

#### データテーブル
- **タイトル**: リソース名
- **操作ボタン**: 更新・作成・全削除
- **データ表示**: 表形式でのデータ一覧
- **件数表示**: 合計件数

## 技術仕様

### フロントエンド
- **React 18**: 最新のReact機能を使用
- **TypeScript**: 型安全性の確保
- **Tailwind CSS**: モダンなスタイリング
- **Axios**: HTTP通信ライブラリ

### デバッグサーバー
- **ポート**: 8081（デフォルト）
- **エンドポイント**: `/debug/*`
- **認証**: なし（デバッグ用）
- **CORS**: 開発環境でのクロスオリジン対応
- **環境変数**: `.env`ファイルから読み取り

### API エンドポイント一覧

#### GET エンドポイント
- `GET /debug/organizations` - 組織一覧
- `GET /debug/users` - ユーザー一覧
- `GET /debug/rooms` - 部屋一覧
- `GET /debug/devices` - デバイス一覧
- `GET /debug/subjects` - 科目一覧
- `GET /debug/lessons` - 授業一覧

#### POST エンドポイント
- `POST /debug/organizations` - 組織作成
- `POST /debug/users` - ユーザー作成
- `POST /debug/rooms` - 部屋作成
- `POST /debug/devices` - デバイス作成
- `POST /debug/subjects` - 科目作成
- `POST /debug/lessons` - 授業作成
- `POST /debug/seed` - シードデータ作成

#### DELETE エンドポイント
- `DELETE /debug/organizations` - 組織全削除
- `DELETE /debug/users` - ユーザー全削除
- `DELETE /debug/rooms` - 部屋全削除
- `DELETE /debug/devices` - デバイス全削除
- `DELETE /debug/subjects` - 科目全削除
- `DELETE /debug/lessons` - 授業全削除
- `DELETE /debug/reset` - データベースリセット

## トラブルシューティング

### よくある問題

1. **API接続エラー**
   - デバッグサーバーが起動しているか確認
   - ポート番号（8081）が正しいか確認
   - CORS設定を確認

2. **データが表示されない**
   - ブラウザの開発者ツールでネットワークエラーを確認
   - デバッグサーバーのログを確認
   - データベース接続を確認

3. **作成・削除が失敗する**
   - 依存関係を確認（例：ユーザー作成前に組織が必要）
   - デバッグサーバーのエラーログを確認
   - データベースの制約を確認

4. **環境変数の問題**
   - `.env`ファイルが正しく配置されているか確認
   - データベース接続情報が正しいか確認
   - デバッグサーバーのポートが競合していないか確認

### 開発時の注意事項

- **本番環境では使用禁止**: デバッグ用のため認証なし
- **データのバックアップ**: 重要なデータは事前にバックアップ
- **依存関係の順序**: データ作成時は適切な順序で実行

## カスタマイズ

### スタイルの変更
```css
/* src/App.css でカスタムスタイルを追加 */
.custom-style {
  /* カスタムスタイル */
}
```

### API URLの変更
```bash
# .env.local ファイルでAPI URLを変更
REACT_APP_API_URL=http://your-debug-server:8081
```

### 新しいリソースの追加
1. `src/types/index.ts` に型定義を追加
2. `src/services/api.ts` にAPI関数を追加
3. `src/App.tsx` に状態管理とUIを追加

## デプロイ

### 本番環境での使用
- 認証機能の追加を推奨
- HTTPS通信の設定
- 適切なアクセス制御

### Docker化
```dockerfile
# フロントエンド用Dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

このWeb版デバッグツールにより、CLIツールと同様の機能をより直感的なWebインターフェースで提供できます。
